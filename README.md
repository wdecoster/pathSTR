# pathSTR-1000G

Repository for the pathSTR web app at <https://pathstr.bioinf.be>

If pathSTR is useful to you, please cite our [publication](https://www.medrxiv.org/content/10.1101/2024.03.06.24303700v1).

## aSTRonaut companion script

We provide [aSTRonaut](https://github.com/wdecoster/pathSTR/blob/main/scripts/aSTRonaut.py) for a more flexible approach to create the "sequence" repeat composition plot. This script requires VCF files, as generated by STRdust, but could be adapted to handle LongTR genotypes. Please let me know if that is of interest.

### Installation aSTRonaut

The script requires some python dependencies, which can be installed using pip or conda/mamba

```bash
pip install -r requirements.txt
# or
conda create -n astronaut pandas cyvcf2 plotly
conda activate astronaut
```

Clone the repository and run the script:

```bash
git clone https://github.com/wdecoster/pathSTR/
python pathSTR/scripts/aSTRonaut.py --help
```

### aSTRonaut usage

#### Example

```bash
python aSTRonaut.py data/*.vcf.gz --kmer 3 --repeat chr1:1000000 -o test.html
python aSTRonaut.py data/*.vcf.gz --motifs ATC,ATG,ATT --repeat chr1:1000000 -o test.html
```

```text
usage: aSTRonaut.py [-h] [-k KMER] [--motifs MOTIFS] [--repeat REPEAT] [-o OUT] [-m MINLEN] [-n NUMBER]
                    [--hide-labels] [--publication] [--title TITLE] [--sampleinfo SAMPLEINFO]
                    vcf [vcf ...]

Create a repeat sequence plot similar to the pathSTR <sequence> composition vizualization, but stand-alone

positional arguments:
  vcf                   VCF files to analyze

options:
  -h, --help                show this help message and exit
  -k, --kmer KMER           Kmer length to use for plot
  --motifs MOTIFS           Specify the motifs to plot, comma separated
  --repeat REPEAT           Chromosome and POS of repeat to plot e.g. chr1:12345
  -o, --out OUT             Output file name (html)
  -m, --minlen MINLEN       Minimal repeat length to plot
  -n, --number NUMBER       Number of kmers to plot
  --hide-labels             Hide sample labels
  --publication             Create a plot for publication
  --title TITLE             Title of the plot
  --sampleinfo SAMPLEINFO   TSV file with sample information
```

The tool takes either an integer motif length (-k, --kmer) or a predefined list of motifs (--motifs). The sampleinfo file (optional) should contain a "name" and "group" column, which will be used to highlight samples that are "case". Other values will be ignored.

We did our best to make aSTRonaut generate pretty visualizations for all scenarios, but if it doesn't look great for your data, please let us know. Feature requests are highly appreciated.

## Installation repeat genotyping workflow

This repository contains the code for the pathSTR web app. For a local installation, you will need to install the dependencies as specified in requirements.txt. You can do this by running the following command in the root directory of the repository:

```bash
pip install -r requirements.txt
```

The pathSTR-1000G.smk workflow uses snakemake to manage the pipeline. You can install snakemake using pip:

```bash
pip install snakemake
```

At the top of the file some paths have to be set, including reference genomes, the work_dir and the location of the STRdust binary.
This was not developed into a more convenient configuration file yet, as I do not anticipate many users running this pipeline. It is provided for completeness and transparency.

The pipeline is ran as:

```bash
snakemake -s workflow/pathSTR-1000G.smk --use-conda --cores 24 --keep-going
```

## Preparing a list for samples for the Gustafson source

Listing all files from the AWS bucket, subsetting to hg38 bams from the standard minimap2 pipeline

```bash
aws s3 ls 1000g-ont --no-sign-request --recursive | grep -i minimap | grep bam$ | grep -v chm13 | cut -f4 -d' ' > data/list-miller-20240606.txt
```

--> results in 157 paths to bam files, without duplicates

## Adapting LongTR to genotype remote cram files

LongTR will check if a local path is valid, but other than that just works on remote cram files.
To remove the local path check, remove or comment out [these two lines](https://github.com/gymrek-lab/LongTR/blob/d9323818eea55cbf55ac72ee7992c6b901a25bdc/src/bam_io.cpp#L70) in bam_io.cpp before running `make`. It is possible that this will become a feature of LongTR and that this hack will then no longer be necessary.
